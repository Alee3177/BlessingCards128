<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>祝福經句紅包 - 經句顯示</title>

<style>
:root {
  --bg: #fff7e6;
  --brown-text: #8a5500;
  --brown-title: #b37500;
  --gold-light: #ffe9a3;
  --gold-mid: #ffd166;
  --gold-dark: #e8a838;
}

body {
  margin: 0;
  background: var(--bg);
  font-family: "NotoSansTC", sans-serif;
  text-align: center;
  color: var(--brown-text);
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px 16px 60px;
}

/* logo */
.logo-box {
  width: 100%;
  text-align: center;
  margin-top: 10px;
}
.logo {
  width: 180px;
  height: auto;
  margin-bottom: 10px;
}

h1 {
  font-size: 24px;
  margin: 10px 0 20px;
  color: var(--brown-title);
}

.info {
  font-size: 18px;
  margin-bottom: 10px;
}

.verseRef {
  font-size: 20px;
  color: #8a5500;
  font-weight: 700;
  margin-bottom: 20px;
}

.cardImg {
  width: 85%;
  max-width: 480px;
  border-radius: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  margin-top: 20px;
}

.btn {
  min-width: 200px;
  padding: 12px 20px;
  margin: 10px auto;
  border: none;
  border-radius: 999px;
  background: linear-gradient(180deg, var(--gold-light), var(--gold-mid));
  font-size: 18px;
  font-weight: 600;
  color: var(--brown-text);
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
  cursor: pointer;
}
.btn:hover {
  background: linear-gradient(180deg, var(--gold-mid), var(--gold-dark));
}
</style>

<!-- 字型 & 經文對照 -->
<script src="font_base64.js"></script>
<script src="verseRefMap.js"></script>

<!-- 亮片特效 -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

</head>
<body>

<!-- logo -->
<div class="logo-box">
  <img src="logo3524.png" class="logo" alt="logo">
</div>

<!-- 開場音效（觀看時播放 win.mp3） -->
<audio id="winSound" src="audio/win.mp3" preload="auto"></audio>

<div class="container">

  <h1>祝福經句紅包</h1>

  <div class="info" id="nameField"></div>
  <div class="verseRef" id="verseRef"></div>

  <img id="verseImg" class="cardImg" src="" alt="經句圖片">

  <button class="btn" onclick="downloadImage()">下載經句圖片</button>

</div>

<script>
/* ============ 取得 URL 參數 ============ */
function getQuery(key){
  return new URLSearchParams(window.location.search).get(key);
}

const verseNo  = getQuery("no");   // 001~128
const name     = getQuery("name") ? decodeURIComponent(getQuery("name")) : "";

/* ============ 顯示姓名 / 顯示經文章節 ============ */

document.getElementById("nameField").textContent =
  name ? `抽中： ${name}` : "";

let verseRef = "";
if(window.VERSE_REF_MAP){
  verseRef = window.VERSE_REF_MAP[verseNo] || "";
}
document.getElementById("verseRef").textContent =
  verseRef ? `（${verseRef}）` : "";

/* ============ 顯示對應圖片 ============ */

const img = document.getElementById("verseImg");
img.src = `cards/${verseNo}.png`;

/* ============ 播放中獎音效 ============ */
const winSound = document.getElementById("winSound");
winSound.currentTime = 0;
winSound.play().catch(()=>{});

/* ============ 亮片特效 ============ */

setTimeout(()=>{
  confetti({
    particleCount: 140,
    spread: 90,
    origin: { y: 0.25 }
  });
}, 300);

/* ============ 下載圖片 ============ */
function downloadImage(){
  const link = document.createElement("a");
  link.href = img.src;
  link.download = `blessing_${verseNo}.png`;
  link.click();
}
</script>

</body>
</html>
