<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BlessingCards128 - ç¶“å¥</title>

<link rel="stylesheet" href="fonts/fonts.css">

<style>
  body {
    margin:0;
    background:#fff7e6;
    font-family:"NotoSansTC", sans-serif;
    text-align:center;
    color:#8a5500;
  }
  .container {
    max-width:900px;
    margin:auto;
    padding:20px;
  }
  .logo {
    width:120px;
    margin-top:20px;
  }
  h1 {
    font-size:26px;
    color:#b37500;
    margin-top:10px;
  }
  #cardImg {
    max-width:90%;
    height:auto;
    margin-top:15px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.15);
  }
  .info {
    margin-top:15px;
    font-size:20px;
    line-height:1.6;
  }
  .hint {
    margin-top:8px;
    font-size:14px;
    color:#aa5500;
  }
  .btn {
    background:#ffcc66;
    border:none;
    padding:12px 22px;
    border-radius:10px;
    font-size:20px;
    cursor:pointer;
    margin-top:16px;
    margin-inline:4px;
  }
  .btn:hover { background:#ffdd88; }

  /* ç…™ç« canvas */
  #fwCanvas {
    position:fixed;
    left:0;
    top:0;
    width:100%;
    height:100%;
    pointer-events:none;
  }
  .coin {
    position:fixed;
    top:-40px;
    width:32px;
    pointer-events:none;
    animation:fallCoin linear forwards;
  }
  @keyframes fallCoin {
    from { transform:translateY(-40px); opacity:1; }
    to   { transform:translateY(100vh); opacity:0; }
  }
</style>
</head>
<body>
<canvas id="fwCanvas"></canvas>

<div class="container">
  <img src="logo3524.png" class="logo" alt="logo" />
  <h1>ç´…åŒ…ç¥ç¦ç¶“å¥</h1>

  <img id="cardImg" src="" alt="ç¶“å¥åœ–ç‰‡" />

  <div class="info" id="infoText"></div>
  <div class="hint" id="audioHint" style="display:none;">
    ğŸ”Š è‹¥æ²’æœ‰è½åˆ°éŸ³æ•ˆï¼Œè«‹è¼•è§¸ç•«é¢ä»»æ„ä½ç½®ä¸€æ¬¡ã€‚
  </div>

  <div>
    <button class="btn" onclick="goHome()">å›é¦–é </button>
    <button class="btn" onclick="goCategory()">åˆ†é¡æŠ½ç±¤</button>
  </div>
</div>

<script>
/* 1~128 æ›¸å·ï¼‹ç« ç¯€å°ç…§ */
const verseInfo = [
  {},
  {book:"ä»¥è³½äºæ›¸",ref:"26:3-4"},
  {book:"ä»¥è³½äºæ›¸",ref:"27:3"},
  {book:"ä»¥è³½äºæ›¸",ref:"30:15"},
  {book:"ä»¥è³½äºæ›¸",ref:"30:18"},
  {book:"ä»¥è³½äºæ›¸",ref:"33:2"},
  {book:"ä»¥è³½äºæ›¸",ref:"33:6"},
  {book:"ä»¥è³½äºæ›¸",ref:"33:15-16"},
  {book:"ä»¥è³½äºæ›¸",ref:"38:3"},
  {book:"ä»¥è³½äºæ›¸",ref:"40:31"},
  {book:"ä»¥è³½äºæ›¸",ref:"41:9-10"},
  {book:"ä»¥è³½äºæ›¸",ref:"49:25"},
  {book:"ä»¥è³½äºæ›¸",ref:"54:2"},
  {book:"ä»¥è³½äºæ›¸",ref:"53:5"},
  {book:"ä»¥è³½äºæ›¸",ref:"49:15"},
  {book:"ä»¥è³½äºæ›¸",ref:"48:17-18"},
  {book:"ä»¥è³½äºæ›¸",ref:"43:4"},
  {book:"ä»¥è³½äºæ›¸",ref:"43:2"},
  {book:"ä»¥è³½äºæ›¸",ref:"12:2"},
  {book:"ä»¥è³½äºæ›¸",ref:"54:10"},
  {book:"ä»¥è³½äºæ›¸",ref:"61:10"},
  {book:"è€¶åˆ©ç±³æ›¸",ref:"15:16"},
  {book:"è€¶åˆ©ç±³æ›¸",ref:"16:19"},
  {book:"è€¶åˆ©ç±³æ›¸",ref:"17:7-8"},
  {book:"è€¶åˆ©ç±³æ›¸",ref:"20:11"},
  {book:"è€¶åˆ©ç±³æ›¸",ref:"29:11-13"},
  {book:"è©©ç¯‡",ref:"1:1-3"},
  {book:"è©©ç¯‡",ref:"3:3ï¼Œ16:11"},
  {book:"è©©ç¯‡",ref:"5:11-12"},
  {book:"è©©ç¯‡",ref:"16:8-9"},
  {book:"è©©ç¯‡",ref:"17:8"},
  {book:"è©©ç¯‡",ref:"18:2"},
  {book:"è©©ç¯‡",ref:"18:30-32"},
  {book:"è©©ç¯‡",ref:"27:1"},
  {book:"è©©ç¯‡",ref:"27:4"},
  {book:"è©©ç¯‡",ref:"27:14"},
  {book:"è©©ç¯‡",ref:"28:7"},
  {book:"è©©ç¯‡",ref:"30:4-5"},
  {book:"è©©ç¯‡",ref:"31:19"},
  {book:"è©©ç¯‡",ref:"34:8-10"},
  {book:"è©©ç¯‡",ref:"37:3-5"},
  {book:"è©©ç¯‡",ref:"37:23-24"},
  {book:"è©©ç¯‡",ref:"41:12-13"},
  {book:"è©©ç¯‡",ref:"50:14-15"},
  {book:"è©©ç¯‡",ref:"50:23"},
  {book:"è©©ç¯‡",ref:"52:8-9"},
  {book:"è©©ç¯‡",ref:"55:22"},
  {book:"è©©ç¯‡",ref:"60:12"},
  {book:"è©©ç¯‡",ref:"63:7-8"},
  {book:"è©©ç¯‡",ref:"71:5-6ï¼Œ9"},
  {book:"è©©ç¯‡",ref:"73:25-26"},
  {book:"è©©ç¯‡",ref:"73:28"},
  {book:"è©©ç¯‡",ref:"81:10"},
  {book:"è©©ç¯‡",ref:"84:10-11"},
  {book:"è©©ç¯‡",ref:"86:11-13"},
  {book:"è©©ç¯‡",ref:"91:1-2"},
  {book:"è©©ç¯‡",ref:"91:9-12"},
  {book:"è©©ç¯‡",ref:"91:14-16"},
  {book:"è©©ç¯‡",ref:"103:2-5"},
  {book:"è©©ç¯‡",ref:"103:17-18"},
  {book:"è©©ç¯‡",ref:"108:13"},
  {book:"è©©ç¯‡",ref:"115:11-13"},
  {book:"è©©ç¯‡",ref:"118:5-6"},
  {book:"è©©ç¯‡",ref:"118:8-9"},
  {book:"è©©ç¯‡",ref:"118:14"},
  {book:"è©©ç¯‡",ref:"118:24"},
  {book:"è©©ç¯‡",ref:"119:105"},
  {book:"è©©ç¯‡",ref:"121:1-2"},
  {book:"è©©ç¯‡",ref:"121:5-8"},
  {book:"è©©ç¯‡",ref:"125:1-2"},
  {book:"è©©ç¯‡",ref:"127:1-2"},
  {book:"è©©ç¯‡",ref:"128:1-2"},
  {book:"è©©ç¯‡",ref:"131:1-2"},
  {book:"è©©ç¯‡",ref:"139:13-14"},
  {book:"è©©ç¯‡",ref:"139:17-18"},
  {book:"è©©ç¯‡",ref:"140:7"},
  {book:"è©©ç¯‡",ref:"144:2"},
  {book:"è©©ç¯‡",ref:"145:17-19"},
  {book:"ç®´è¨€",ref:"3:5-6"},
  {book:"ç®´è¨€",ref:"3:24-26"},
  {book:"ç®´è¨€",ref:"4:20-23"},
  {book:"ç®´è¨€",ref:"9:10-11"},
  {book:"ç®´è¨€",ref:"10:22"},
  {book:"ç®´è¨€",ref:"14:26-27"},
  {book:"ç®´è¨€",ref:"16:3"},
  {book:"ç®´è¨€",ref:"17:22"},
  {book:"ç®´è¨€",ref:"19:23"},
  {book:"ç®´è¨€",ref:"22:4"},
  {book:"ç®´è¨€",ref:"31:10-12"},
  {book:"ç”³å‘½è¨˜",ref:"6:4-5"},
  {book:"ç”³å‘½è¨˜",ref:"28:6-7"},
  {book:"ç”³å‘½è¨˜",ref:"28:12"},
  {book:"ç”³å‘½è¨˜",ref:"28:13-14"},
  {book:"ç”³å‘½è¨˜",ref:"30:20"},
  {book:"ç”³å‘½è¨˜",ref:"31:8"},
  {book:"ç”³å‘½è¨˜",ref:"33:12"},
  {book:"ç´„æ›¸äºè¨˜",ref:"1:8"},
  {book:"ç´„æ›¸äºè¨˜",ref:"1:9"},
  {book:"ç´„æ›¸äºè¨˜",ref:"24:15"},
  {book:"æ’’æ¯è€³è¨˜ä¸‹",ref:"22:2-3"},
  {book:"æ’’æ¯è€³è¨˜ä¸‹",ref:"22:31"},
  {book:"æ’’æ¯è€³è¨˜ä¸‹",ref:"23:5"},
  {book:"é¦¬å¤ªç¦éŸ³",ref:"7:7"},
  {book:"é¦¬å¤ªç¦éŸ³",ref:"6:32-33"},
  {book:"é¦¬å¤ªç¦éŸ³",ref:"11:28-29"},
  {book:"é¦¬å¤ªç¦éŸ³",ref:"21:21-22"},
  {book:"ç´„ç¿°ç¦éŸ³",ref:"14:21"},
  {book:"ç´„ç¿°ç¦éŸ³",ref:"14:27"},
  {book:"ç´„ç¿°ç¦éŸ³",ref:"15:5"},
  {book:"ç´„ç¿°ç¦éŸ³",ref:"16:33"},
  {book:"ä½¿å¾’è¡Œå‚³",ref:"2:25-28"},
  {book:"ç¾…é¦¬æ›¸",ref:"8:26-28"},
  {book:"ç¾…é¦¬æ›¸",ref:"8:31-32"},
  {book:"å“¥æ—å¤šå‰æ›¸",ref:"2:9"},
  {book:"å“¥æ—å¤šå¾Œæ›¸",ref:"12:9"},
  {book:"ä»¥å¼—æ‰€æ›¸",ref:"3:20"},
  {book:"è…“ç«‹æ¯”æ›¸",ref:"4:4ï¼Œ6-7"},
  {book:"è…“ç«‹æ¯”æ›¸",ref:"3:13-14"},
  {book:"è…“ç«‹æ¯”æ›¸",ref:"4:11-13"},
  {book:"è…“ç«‹æ¯”æ›¸",ref:"4:19"},
  {book:"æ­Œç¾…è¥¿æ›¸",ref:"3:16-17"},
  {book:"å¸–æ’’ç¾…å°¼è¿¦å‰æ›¸",ref:"5:16-18"},
  {book:"ææ‘©å¤ªå‰æ›¸",ref:"6:6-7"},
  {book:"ææ‘©å¤ªå¾Œæ›¸",ref:"1:7"},
  {book:"å¸Œä¼¯ä¾†æ›¸",ref:"13:15-16"},
  {book:"å½¼å¾—å‰æ›¸",ref:"5:7-8"},
  {book:"ç´„ç¿°å£¹æ›¸",ref:"4:4"},
  {book:"ç´„ç¿°å£¹æ›¸",ref:"5:14-15"},
  {book:"é¦¬å¯ç¦éŸ³",ref:"12:30-31"}
];

/* åŒ index_category çš„åˆ†é¡è¡¨ï¼ˆè‹¥ URL æ²’å¸¶ catï¼Œå°±ç”¨é€™è£¡æ¨ç®—ï¼‰ */
const categoryMap = [
  "",
  "å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","ç›¼æœ›èˆ‡åŠ›é‡","æ©å…¸èˆ‡æ†æ†«","å¹³å®‰èˆ‡ä¿è­·","ä¾›æ‡‰èˆ‡è±ç››","å…¶ä»–","å…¶ä»–",
  "ç›¼æœ›èˆ‡åŠ›é‡","ç›æœ›èˆ‡åŠ›é‡","å¹³å®‰èˆ‡ä¿è­·","ç›¼æœ›èˆ‡åŠ›é‡","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·",
  "å…¶ä»–","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","å¹³å®‰èˆ‡ä¿è­·","å¹³å®‰èˆ‡ä¿è­·","å–œæ¨‚èˆ‡æ„Ÿæ©","å¹³å®‰èˆ‡ä¿è­·",
  "ä¿¡å¿ƒèˆ‡é †æœ","æ™ºæ…§èˆ‡å¼•å°","å¹³å®‰èˆ‡ä¿è­·","æ™ºæ…§èˆ‡å¼•å°","æ™ºæ…§èˆ‡å¼•å°","æ©å…¸èˆ‡æ†æ†«",
  "å–œæ¨‚èˆ‡æ„Ÿæ©","å¹³å®‰èˆ‡ä¿è­·","å¹³å®‰èˆ‡ä¿è­·","ç›¼æœ›èˆ‡åŠ›é‡","å¹³å®‰èˆ‡ä¿è­·","ä¿¡å¿ƒèˆ‡é †æœ",
  "ç›¼æœ›èˆ‡åŠ›é‡","ç›¼æœ›èˆ‡åŠ›é‡","æ©å…¸èˆ‡æ†æ†«","æ©å…¸èˆ‡æ†æ†«","ä¿¡å¿ƒèˆ‡é †æœ","ä¿¡å¿ƒèˆ‡é †æœ",
  "æ™ºæ…§èˆ‡å¼•å°","å…¶ä»–","å–œæ¨‚èˆ‡æ„Ÿæ©","å–œæ¨‚èˆ‡æ„Ÿæ©","æ©å…¸èˆ‡æ†æ†«","å…¶ä»–","ä¿¡å¿ƒèˆ‡é †æœ",
  "å…¶ä»–","ç›¼æœ›èˆ‡åŠ›é‡","ç›¼æœ›èˆ‡åŠ›é‡","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","æ©å…¸èˆ‡æ†æ†«","æ©å…¸èˆ‡æ†æ†«",
  "å¹³å®‰èˆ‡ä¿è­·","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","æ©å…¸èˆ‡æ†æ†«","æ©å…¸èˆ‡æ†æ†«","ä¿¡å¿ƒèˆ‡é †æœ","ä¿¡å¿ƒèˆ‡é †æœ",
  "å…¶ä»–","ä¿¡å¿ƒèˆ‡é †æœ","å¹³å®‰èˆ‡ä¿è­·","å–œæ¨‚èˆ‡æ„Ÿæ©","å…¶ä»–","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","ä¿¡å¿ƒèˆ‡é †æœ",
  "å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","ç›¼æœ›èˆ‡åŠ›é‡","æ©å…¸èˆ‡æ†æ†«","å¹³å®‰èˆ‡ä¿è­·","ä¿¡å¿ƒèˆ‡é †æœ",
  "å¹³å®‰èˆ‡ä¿è­·","å¹³å®‰èˆ‡ä¿è­·","æ™ºæ…§èˆ‡å¼•å°","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","å–œæ¨‚èˆ‡æ„Ÿæ©",
  "å…¶ä»–","å…¶ä»–","ä¿¡å¿ƒèˆ‡é †æœ","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–",
  "æ™ºæ…§èˆ‡å¼•å°","ç›¼æœ›èˆ‡åŠ›é‡","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–",
  "ä¿¡å¿ƒèˆ‡é †æœ","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","æ™ºæ…§èˆ‡å¼•å°","å…¶ä»–","å…¶ä»–",
  "å…¶ä»–","æ©å…¸èˆ‡æ†æ†«","å…¶ä»–","å¹³å®‰èˆ‡ä¿è­·","å…¶ä»–","ç›¼æœ›èˆ‡åŠ›é‡","ä¾›æ‡‰èˆ‡è±ç››","ä¾›æ‡‰èˆ‡è±ç››",
  "å–œæ¨‚èˆ‡æ„Ÿæ©","å…¶ä»–","ç›¼æœ›èˆ‡åŠ›é‡","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–","å…¶ä»–"
];

let winAudio = new Audio("audio/win.mp3");
let audioHintShown = false;

document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(location.search);
  const noStr  = params.get("no");
  const name   = decodeURIComponent(params.get("name") || "ï¼ˆæœªå¡«å§“åï¼‰");
  let catQuery = params.get("cat");
  if(catQuery) catQuery = decodeURIComponent(catQuery);

  const verseNo = parseInt(noStr,10);
  if(!verseNo || verseNo<1 || verseNo>128){
    alert("ç„¡æ•ˆçš„ç¶“å¥ç·¨è™Ÿï¼Œå°‡è¿”å›é¦–é ã€‚");
    location.href = "index.html";
    return;
  }

  const info = verseInfo[verseNo] || {book:"",ref:""};
  const book = info.book;
  const ref  = info.ref;
  const category = catQuery || categoryMap[verseNo] || "æœªåˆ†é¡";

  const padded = String(verseNo).padStart(3,"0");

  // åœ–ç‰‡è¼‰å…¥ï¼šå…ˆçœ‹ cards/ï¼Œå¤±æ•—å†çœ‹æ ¹ç›®éŒ„
  const img = document.getElementById("cardImg");
  img.src = `cards/${padded}.png`;
  img.onerror = function(){
    img.onerror = null;
    img.src = `${padded}.png`;
  };

  // é¡¯ç¤ºæ–‡å­—
  document.getElementById("infoText").innerHTML =
    `âœ¨ æŠ½ä¸­ç¬¬ <b>${padded}</b> è™Ÿç´…åŒ…ç¶“å¥<br>` +
    `${book} ${ref}<br>` +
    `åˆ†é¡ï¼š${category}<br>` +
    `å¾—çè€…ï¼š<b>${name}</b>`;

  // å¯«å…¥æŠ½ç±¤ç´€éŒ„ï¼ˆä¾› PDF ä½¿ç”¨ï¼‰
  writeLog(name, category, verseNo, `${book} ${ref}`);

  // ç‰¹æ•ˆï¼‹éŸ³æ•ˆ
  startFireworks();
  startCoins();
  setupAudioAutoPlay();
});

/* æŠ½ç±¤ç´€éŒ„å¯«å…¥ drawLogs */
function writeLog(name, category, verseNo, verseRef){
  let logs = [];
  try{
    logs = JSON.parse(localStorage.getItem("drawLogs") || "[]");
  }catch(e){
    logs = [];
  }

  const now = new Date();
  const timeStr = now.toLocaleString("zh-TW", {
    year:"numeric", month:"2-digit", day:"2-digit",
    hour:"2-digit", minute:"2-digit", second:"2-digit",
    hour12:true
  });

  logs.push({
    time: timeStr,
    name,
    category,
    verseNo,
    verseRef
  });

  localStorage.setItem("drawLogs", JSON.stringify(logs));
}

/* éŸ³æ•ˆï¼šå…ˆå˜—è©¦è‡ªå‹•æ’­æ”¾ï¼Œè‹¥è¢«æ“‹æ‰å°±é¡¯ç¤ºæç¤ºï¼Œç­‰å¾…ä½¿ç”¨è€…è§¸æ§ä¸€æ¬¡ */
function setupAudioAutoPlay(){
  const hint = document.getElementById("audioHint");

  winAudio.currentTime = 0;
  winAudio.play().then(()=>{
    // å¯ä»¥è‡ªå‹•æ’­æ”¾ï¼Œä»€éº¼éƒ½ä¸ç”¨åš
  }).catch(()=>{
    // è‡ªå‹•æ’­æ”¾è¢«é˜»æ“‹ï¼Œé¡¯ç¤ºæç¤ºï¼Œä¸¦ç­‰å¾…ä½¿ç”¨è€…é»ä¸€ä¸‹
    showAudioHint();
    const onceHandler = () => {
      winAudio.currentTime = 0;
      winAudio.play().finally(()=>{
        hideAudioHint();
      });
      document.removeEventListener("click", onceHandler);
      document.removeEventListener("touchstart", onceHandler);
    };
    document.addEventListener("click", onceHandler);
    document.addEventListener("touchstart", onceHandler);
  });

  function showAudioHint(){
    if(audioHintShown) return;
    audioHintShown = true;
    hint.style.display = "block";
  }
  function hideAudioHint(){
    hint.style.display = "none";
  }
}

/* ç…™ç«èˆ‡é‡‘å¹£ç‰¹æ•ˆ */
const fwCanvas = document.getElementById("fwCanvas");
const fwCtx = fwCanvas.getContext("2d");
let fireArr = [];

function resizeFW(){
  fwCanvas.width = window.innerWidth;
  fwCanvas.height = window.innerHeight;
}
resizeFW();
window.addEventListener("resize", resizeFW);

function launchFire(){
  fireArr.push({
    x:Math.random()*fwCanvas.width,
    y:Math.random()*fwCanvas.height*0.5,
    r:2,
    c:`hsl(${Math.random()*360},100%,60%)`,
    life:30+Math.random()*20
  });
}

function drawFire(){
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
  for(let i=fireArr.length-1;i>=0;i--){
    const f = fireArr[i];
    fwCtx.beginPath();
    fwCtx.arc(f.x,f.y,f.r,0,Math.PI*2);
    fwCtx.fillStyle = f.c;
    fwCtx.fill();
    f.r += 2;
    f.life--;
    if(f.life<=0) fireArr.splice(i,1);
  }
  requestAnimationFrame(drawFire);
}
drawFire();

function startFireworks(){
  for(let i=0;i<12;i++){
    setTimeout(launchFire, i*150);
  }
}

function startCoins(){
  for(let i=0;i<15;i++){
    setTimeout(()=>{
      const coin = document.createElement("img");
      coin.src = "https://cdn-icons-png.flaticon.com/512/138/138292.png";
      coin.className = "coin";
      coin.style.left = Math.random()*window.innerWidth + "px";
      coin.style.animationDuration = (1.2 + Math.random()) + "s";
      document.body.appendChild(coin);
      setTimeout(()=>coin.remove(),2500);
    }, i*120);
  }
}

/* å°è¦½ */
function goHome(){
  location.href = "index.html";
}
function goCategory(){
  location.href = "index_category.html";
}
</script>

</body>
</html>
