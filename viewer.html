<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />

<title>抽中的經句紅包</title>

<style>
body {
    font-family: "Noto Sans TC", sans-serif;
    background: #fffdf7;
    text-align: center;
    margin: 0;
    padding: 0;
    color: #5a4635;
}

#resultText {
    margin-top: 30px;
    font-size: 22px;
    white-space: pre-line;
    font-weight: bold;
}

#verseImage {
    margin-top: 22px;
    width: 320px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.18);
}

/* 按鈕 */
button {
    width: 240px;
    padding: 14px;
    margin: 12px;
    font-size: 20px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #fceabb, #f8b500);
    color: #5a4635;
    font-weight: bold;
    transition: 0.25s;
}
button:hover {
    transform: scale(1.05);
}
</style>

<!-- Confetti 特效 -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<!-- 經句對照表 -->
<script src="verseRefMap.js"></script>

</head>

<body>

<div id="resultText">載入中…</div>

<img id="verseImage" src="" alt="verse image">

<br>

<button onclick="downloadImage()">⬇ 下載經句圖片</button><br>
<button onclick="nextPerson()">下一位</button><br>
<button onclick="goHome()">回首頁</button>

<script>
// ====================== 工具 ======================
function getParam(key){
    const url = new URL(window.location.href);
    return url.searchParams.get(key);
}

// ====================== 主程式 ======================
window.onload = function(){
    const name  = getParam("name")  || "???";
    const verse = getParam("verse") || "001";

    // ====================== 時間格式 ======================
    const now = new Date();
    const timeString =
        `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,"0")}/${now.getDate().toString().padStart(2,"0")} ` +
        `${now.getHours().toString().padStart(2,"0")}:${now.getMinutes().toString().padStart(2,"0")}:${now.getSeconds().toString().padStart(2,"0")}`;

    // ====================== 書卷章節 ======================
    const ref = window.VERSE_REF_MAP[verse] || "";

    // ====================== 顯示兩行置中文字 ======================
    const line1 = `[${timeString}] ${name}｜抽中的經句紅包`;
    const line2 = `編號「${verse}」${ref ? `（${ref}）` : ""}`;

    document.getElementById("resultText").innerText = line1 + "\n" + line2;

    // ====================== 顯示經句圖片 ======================
    document.getElementById("verseImage").src = `cards/${verse}.png`;

    // ====================== 播放獎勵音效 ======================
    const win = new Audio("audio/win.mp3");
    win.play().catch(()=>{});

    // ====================== Confetti ======================
    confetti({
        particleCount: 180,
        spread: 80,
        origin: { y: 0.3 }
    });
};

// ====================== 下載經句圖 ======================
function downloadImage(){
    const verse = getParam("verse");
    const url = `cards/${verse}.png`;

    const a = document.createElement("a");
    a.href = url;
    a.download = `BlessingCard_${verse}.png`;
    a.click();
}

// ====================== 下一位 ======================
function nextPerson(){
    window.location = "index.html";
}

// ====================== 回首頁 ======================
function goHome(){
    window.location = "index.html";
}
</script>

</body>
</html>
