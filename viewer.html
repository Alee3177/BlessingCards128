<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>抽中的祝福經句紅包</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    background: #fffdf7;
    font-family: "Noto Sans TC", sans-serif;
    text-align: center;
    padding: 20px;
    color: #5a4635;
}

/* 頂部兩行資訊 */
#recordBlock {
    font-size: 19px;
    margin-top: 10px;
    margin-bottom: 18px;
    white-space: pre-line;
    line-height: 1.6;
    font-weight: bold;
}

/* 圖片中間顯示的兩行（舊層級） */
#titleName {
    font-size: 22px;
    font-weight: bold;
    margin-top: 16px;
}
#titleVerse {
    font-size: 20px;
    margin-top: 6px;
}

/* 經句 PNG */
#verseImage {
    width: 320px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.18);
}

/* 按鈕 */
.btn {
    background: #f7c86c;
    padding: 14px 24px;
    border-radius: 25px;
    font-size: 18px;
    color: #5a3d00;
    cursor: pointer;
    border: none;
    margin-top: 18px;
}
.btn:hover { background: #f5b953; }
</style>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script src="verseRefMap.js"></script>

</head>

<body>

<!-- 頂部兩行 -->
<div id="recordBlock"></div>

<!-- 舊版置中兩行（仍保留） -->
<div id="titleName"></div>
<div id="titleVerse"></div>

<!-- 經句圖片 -->
<img id="verseImage" src="" alt="verse">

<!-- 按鈕 -->
<br>
<button class="btn" onclick="downloadImage()">⬇ 下載經句圖片</button><br>
<button class="btn" onclick="nextPerson()">下一位</button><br>
<button class="btn" onclick="goHome()">回首頁</button>


<script>
/* -------------------------------
   取得 URL 參數
------------------------------- */
function getParam(key){
    let url = new URL(window.location.href);
    return url.searchParams.get(key);
}

/* -------------------------------
   頁面初始化
------------------------------- */
window.onload = function(){

    const name  = getParam("name")  || "???";
    const verse = getParam("verse") || "001";

    /* timestamp（由 viewer 端自動生成，不依賴 index.html） */
    const now = new Date();
    const ts =
        `${now.getFullYear()}/${String(now.getMonth()+1).padStart(2,"0")}/${String(now.getDate()).padStart(2,"0")} `+
        `${String(now.getHours()).padStart(2,"0")}:${String(now.getMinutes()).padStart(2,"0")}:${String(now.getSeconds()).padStart(2,"0")}`;

    const ref = VERSE_REF_MAP[verse] || "";

    /* -------------------------------
       頂部兩行（置中資訊）
    ------------------------------- */
    const line =
        `[${ts}] ${name}｜抽中的經句紅包\n` +
        `編號「${verse}」${ref ? `（${ref}）` : ""}`;

    document.getElementById("recordBlock").innerText = line;

    /* -------------------------------
       舊版中央兩行資訊（仍保留）
    ------------------------------- */
    document.getElementById("titleName").innerText =
        `${name}｜抽中的經句紅包`;

    document.getElementById("titleVerse").innerText =
        `編號「${verse}」${ref ? `（${ref}）` : ""}`;

    /* -------------------------------
       顯示 PNG
    ------------------------------- */
    document.getElementById("verseImage").src = `cards/${verse}.png`;

    /* -------------------------------
       中獎音效
    ------------------------------- */
    const win = new Audio("audio/win.mp3");
    win.play().catch(()=>{});

    /* -------------------------------
       Confetti 特效
    ------------------------------- */
    confetti({
        particleCount: 230,
        spread: 88,
        origin: { y: 0.32 }
    });
};


/* -------------------------------
   下載經句 PNG
------------------------------- */
function downloadImage(){
    const verse = getParam("verse");
    const a = document.createElement("a");
    a.href = `cards/${verse}.png`;
    a.download = `BlessingCard_${verse}.png`;
    a.click();
}

/* -------------------------------
   下一位（回 index.html）
   名單不清除 → v4.5 核心功能
------------------------------- */
function nextPerson(){
    window.location = "index.html";
}

/* -------------------------------
   回首頁（仍保留名單）
------------------------------- */
function goHome(){
    window.location = "index.html";
}
</script>

</body>
</html>
