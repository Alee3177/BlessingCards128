<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BlessingCards128 - 紅包祝福經句</title>

<link rel="stylesheet" href="fonts/fonts.css">

<style>
    body {
        margin:0;
        background:#fff7e6;
        font-family:"NotoSansTC", sans-serif;
        text-align:center;
        color:#8a5500;
    }
    .container {
        max-width:900px;
        margin:auto;
        padding:20px;
    }
    .logo {
        width:120px;
        margin-top:20px;
    }
    h1 {
        font-size:26px;
        color:#b37500;
        margin-top:10px;
        margin-bottom:5px;
    }
    #nameInfo {
        margin-top:5px;
        font-size:18px;
        color:#7a4a00;
    }
    #cardImg {
        margin-top:20px;
        max-width:320px;
        width:80%;
        box-shadow:0 4px 12px rgba(0,0,0,0.2);
        border-radius:10px;
        background:#fff;
    }
    #line1 {
        margin-top:18px;
        font-size:22px;
        font-weight:bold;
        color:#b37500;
    }
    #line2 {
        margin-top:8px;
        font-size:20px;
        color:#8a5500;
    }
    .btn {
        background:#ffcc66;
        border:none;
        padding:10px 20px;
        border-radius:10px;
        font-size:18px;
        cursor:pointer;
        margin:12px 6px 0 6px;
    }
    .btn:hover { background:#ffdd88; }

    /* 煙火畫布 */
    #fwCanvas {
        position:fixed;
        left:0;
        top:0;
        width:100%;
        height:100%;
        pointer-events:none;
        z-index:10;
    }

    /* 金幣 */
    .coin {
        position:fixed;
        top:-50px;
        width:35px;
        pointer-events:none;
        animation:fallCoin linear forwards;
        z-index:11;
    }
    @keyframes fallCoin {
        from { transform:translateY(-50px); opacity:1; }
        to   { transform:translateY(100vh); opacity:0; }
    }
</style>
</head>

<body>
<canvas id="fwCanvas"></canvas>

<div class="container">
    <img src="logo3524.png" class="logo" />
    <h1>紅包祝福經句</h1>
    <div id="nameInfo"></div>

    <img id="cardImg" src="" alt="紅包經句圖片" />

    <div id="line1"></div>
    <div id="line2"></div>

    <div>
        <button class="btn" onclick="goHome()">回首頁</button>
        <button class="btn" onclick="goCategory()">回分類抽籤</button>
    </div>
</div>

<script>
/* -----------------------------------------------------------
   經句表（1~128）：對應 cards/001.png～128.png
----------------------------------------------------------- */
const verseRefs = [
    "", // 0 佔位
    "以賽亞書 26:3-4",
    "以賽亞書 27:3",
    "以賽亞書 30:15",
    "以賽亞書 30:18",
    "以賽亞書 33:2",
    "以賽亞書 33:6",
    "以賽亞書 33:15-16",
    "以賽亞書 38:3",
    "以賽亞書 40:31",
    "以賽亞書 41:9-10",
    "以賽亞書 49:25",
    "以賽亞書 54:2",
    "以賽亞書 53:5",
    "以賽亞書 49:15",
    "以賽亞書 48:17-18",
    "以賽亞書 43:4",
    "以賽亞書 43:2",
    "以賽亞書 12:2",
    "以賽亞書 54:10",
    "以賽亞書 61:10",
    "耶利米書 15:16",
    "耶利米書 16:19",
    "耶利米書 17:7-8",
    "耶利米書 20:11",
    "耶利米書 29:11-13",
    "詩篇 1:1-3",
    "詩篇 3:3，16:11",
    "詩篇 5:11-12",
    "詩篇 16:8-9",
    "詩篇 17:8",
    "詩篇 18:2",
    "詩篇 18:30-32",
    "詩篇 27:1",
    "詩篇 27:4",
    "詩篇 27:14",
    "詩篇 28:7",
    "詩篇 30:4-5",
    "詩篇 31:19",
    "詩篇 34:8-10",
    "詩篇 37:3-5",
    "詩篇 37:23-24",
    "詩篇 41:12-13",
    "詩篇 50:14-15",
    "詩篇 50:23",
    "詩篇 52:8-9",
    "詩篇 55:22",
    "詩篇 60:12",
    "詩篇 63:7-8",
    "詩篇 71:5-6，9",
    "詩篇 73:25-26",
    "詩篇 73:28",
    "詩篇 81:10",
    "詩篇 84:10-11",
    "詩篇 86:11-13",
    "詩篇 91:1-2",
    "詩篇 91:9-12",
    "詩篇 91:14-16",
    "詩篇 103:2-5",
    "詩篇 103:17-18",
    "詩篇 108:13",
    "詩篇 115:11-13",
    "詩篇 118:5-6",
    "詩篇 118:8-9",
    "詩篇 118:14",
    "詩篇 118:24",
    "詩篇 119:105",
    "詩篇 121:1-2",
    "詩篇 121:5-8",
    "詩篇 125:1-2",
    "詩篇 127:1-2",
    "詩篇 128:1-2",
    "詩篇 131:1-2",
    "詩篇 139:13-14",
    "詩篇 139:17-18",
    "詩篇 140:7",
    "詩篇 144:2",
    "詩篇 145:17-19",
    "箴言 3:5-6",
    "箴言 3:24-26",
    "箴言 4:20-23",
    "箴言 9:10-11",
    "箴言 10:22",
    "箴言 14:26-27",
    "箴言 16:3",
    "箴言 17:22",
    "箴言 19:23",
    "箴言 22:4",
    "箴言 31:10-12",
    "申命記 6:4-5",
    "申命記 28:6-7",
    "申命記 28:12",
    "申命記 28:13-14",
    "申命記 30:20",
    "申命記 31:8",
    "申命記 33:12",
    "約書亞記 1:8",
    "約書亞記 1:9",
    "約書亞記 24:15",
    "撒母耳記下 22:2-3",
    "撒母耳記下 22:31",
    "撒母耳記下 23:5",
    "馬太福音 7:7",
    "馬太福音 6:32-33",
    "馬太福音 11:28-29",
    "馬太福音 21:21-22",
    "約翰福音 14:21",
    "約翰福音 14:27",
    "約翰福音 15:5",
    "約翰福音 16:33",
    "使徒行傳 2:25-28",
    "羅馬書 8:26-28",
    "羅馬書 8:31-32",
    "哥林多前書 2:9",
    "哥林多後書 12:9",
    "以弗所書 3:20",
    "腓立比書 4:4，6-7",
    "腓立比書 3:13-14",
    "腓立比書 4:11-13",
    "腓立比書 4:19",
    "歌羅西書 3:16-17",
    "帖撒羅尼迦前書 5:16-18",
    "提摩太前書 6:6-7",
    "提摩太後書 1:7",
    "希伯來書 13:15-16",
    "彼得前書 5:7-8",
    "約翰壹書 4:4",
    "約翰壹書 5:14-15",
    "馬可福音 12:30-31"
];

/* -----------------------------------------------------------
   分類表（1~128）：與你提供的對照一致
----------------------------------------------------------- */
const categoryMap = [
    "",
    "平安與保護",
    "其他",
    "盼望與力量",
    "恩典與憐憫",
    "平安與保護",
    "供應與豐盛",
    "其他",
    "其他",
    "盼望與力量",
    "盼望與力量",
    "平安與保護",
    "盼望與力量",
    "平安與保護",
    "其他",
    "平安與保護",
    "其他",
    "其他",
    "平安與保護",
    "平安與保護",
    "平安與保護",
    "喜樂與感恩",
    "平安與保護",
    "信心與順服",
    "智慧與引導",
    "平安與保護",
    "智慧與引導",
    "智慧與引導",
    "恩典與憐憫",
    "喜樂與感恩",
    "平安與保護",
    "平安與保護",
    "盼望與力量",
    "平安與保護",
    "信心與順服",
    "盼望與力量",
    "盼望與力量",
    "恩典與憐憫",
    "恩典與憐憫",
    "信心與順服",
    "信心與順服",
    "智慧與引導",
    "其他",
    "喜樂與感恩",
    "喜樂與感恩",
    "恩典與憐憫",
    "其他",
    "信心與順服",
    "其他",
    "盼望與力量",
    "盼望與力量",
    "平安與保護",
    "其他",
    "恩典與憐憫",
    "恩典與憐憫",
    "平安與保護",
    "平安與保護",
    "其他",
    "恩典與憐憫",
    "恩典與憐憫",
    "信心與順服",
    "信心與順服",
    "其他",
    "信心與順服",
    "平安與保護",
    "喜樂與感恩",
    "其他",
    "其他",
    "平安與保護",
    "信心與順服",
    "其他",
    "其他",
    "其他",
    "其他",
    "其他",
    "盼望與力量",
    "恩典與憐憫",
    "平安與保護",
    "信心與順服",
    "平安與保護",
    "平安與保護",
    "智慧與引導",
    "其他",
    "平安與保護",
    "其他",
    "喜樂與感恩",
    "其他",
    "其他",
    "信心與順服",
    "其他",
    "其他",
    "其他",
    "其他",
    "其他",
    "其他",
    "其他",
    "智慧與引導",
    "盼望與力量",
    "其他",
    "平安與保護",
    "其他",
    "其他",
    "其他",
    "其他",
    "其他",
    "信心與順服",
    "其他",
    "平安與保護",
    "其他",
    "平安與保護",
    "智慧與引導",
    "其他",
    "其他",
    "其他",
    "恩典與憐憫",
    "其他",
    "平安與保護",
    "其他",
    "盼望與力量",
    "供應與豐盛",
    "供應與豐盛",
    "喜樂與感恩",
    "其他",
    "盼望與力量",
    "其他",
    "其他",
    "其他",
    "其他",
    "其他"
];

/* -----------------------------------------------------------
   抽籤紀錄寫入 localStorage.drawLogs
----------------------------------------------------------- */
function saveDrawLog(name, verseNo, verseRef, category){
    let logs = [];
    try{
        logs = JSON.parse(localStorage.getItem("drawLogs")) || [];
    }catch(e){
        logs = [];
    }

    const timeStr = new Date().toLocaleString("zh-TW", { hour12:false });

    logs.push({
        time: timeStr,
        name: name || "（未填姓名）",
        verseNo,
        verseRef,
        category
    });

    localStorage.setItem("drawLogs", JSON.stringify(logs));
}

/* -----------------------------------------------------------
   煙火 + 金幣特效
----------------------------------------------------------- */
let fwCanvas = document.getElementById("fwCanvas");
let fwCtx = fwCanvas.getContext("2d");
let fireArr = [];

function resizeFW(){
    fwCanvas.width = window.innerWidth;
    fwCanvas.height = window.innerHeight;
}
resizeFW();
window.addEventListener("resize", resizeFW);

function launchFire(){
    fireArr.push({
        x: Math.random()*fwCanvas.width,
        y: Math.random()*fwCanvas.height*0.5,
        r: 2,
        c: `hsl(${Math.random()*360},100%,60%)`,
        life: 30+Math.random()*20
    });
}
function drawFire(){
    fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
    for(let i=fireArr.length-1;i>=0;i--){
        let f=fireArr[i];
        fwCtx.beginPath();
        fwCtx.arc(f.x,f.y,f.r,0,Math.PI*2);
        fwCtx.fillStyle=f.c;
        fwCtx.fill();
        f.r+=2;
        f.life--;
        if(f.life<=0) fireArr.splice(i,1);
    }
    requestAnimationFrame(drawFire);
}
drawFire();

function startFireworks(){
    for(let i=0;i<12;i++) setTimeout(launchFire, i*150);
}
function startCoins(){
    for(let i=0;i<15;i++){
        setTimeout(()=>{
            let coin=document.createElement("img");
            coin.src="https://cdn-icons-png.flaticon.com/512/138/138292.png";
            coin.className="coin";
            coin.style.left=Math.random()*window.innerWidth+"px";
            coin.style.animationDuration=(1.2+Math.random())+"s";
            document.body.appendChild(coin);
            setTimeout(()=>coin.remove(),2500);
        }, i*120);
    }
}
function celebrate(){
    startFireworks();
    startCoins();
}

/* -----------------------------------------------------------
   主流程：讀參數、顯示圖片與文字、播放音效、記錄
----------------------------------------------------------- */
let winAudio = new Audio("audio/win.mp3");

document.addEventListener("DOMContentLoaded", () => {
    const url = new URL(location.href);
    const noStr = url.searchParams.get("no") || "";
    const name  = url.searchParams.get("name") || "";

    const n = parseInt(noStr,10);
    if(!n || n<1 || n>128){
        alert("無效的經句編號，將返回首頁");
        location.href = "index.html";
        return;
    }

    const padded = String(n).padStart(3,"0");
    const verseRef = verseRefs[n] || "";
    const category = categoryMap[n] || "其他";

    // 顯示姓名
    if(name){
        document.getElementById("nameInfo").textContent = `抽籤姓名：${name}`;
    }else{
        document.getElementById("nameInfo").textContent = "";
    }

    // 設定圖片
    const img = document.getElementById("cardImg");
    img.src = `cards/${padded}.png`;

    // 兩行文字
    document.getElementById("line1").textContent =
        `✨ 抽中第 ${padded} 號紅包經句`;
    document.getElementById("line2").textContent = verseRef;

    // 記錄到 localStorage 供 PDF 使用
    saveDrawLog(name, n, verseRef, category);

    // 播放音效＋特效
    winAudio.currentTime = 0;
    winAudio.play().catch(()=>{});
    celebrate();
});

/* -----------------------------------------------------------
   導覽按鈕
----------------------------------------------------------- */
function goHome(){
    window.location = "index.html";
}
function goCategory(){
    window.location = "index_category.html";
}
</script>

</body>
</html>
