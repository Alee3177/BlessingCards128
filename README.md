📘 **BlessingCards128 — v3.3.1 Final**



祝福經句紅包抽籤系統（姓名模式 / 分類模式 二擇一）



本專案提供教會團契/小組聚會使用的「祝福經句紅包」抽籤系統，包括：



\-🎡 抽姓名輪盤

\-📖 抽分類輪盤

\-📜 對應 128 張祝福經句卡片（cards/001~128）

\-📥 PNG 圖片下載（含抽到者資訊＋經文章節）

\-📝 PDF 匯出完整抽籤紀錄

\-🔒 姓名名單自動鎖定

\-🔒 姓名模式 / 分類模式「二擇一」鎖定

\-💾 全站紀錄（localStorage）自動同步

\-🧨 轉盤音效 + 中獎特效



------------------------------------------

📁 專案結構

BlessingCards128/

│

├── index.html               # 主頁（抽姓名模式）

├── index\_category.html      # 分類抽籤頁面（8分類模式）

├── viewer.html              # 經句圖片顯示 + PNG下載

│

├── cards/                   # 128張PNG祝福紅包圖片（001~128）

│     ├── 001.png

│     ├── ...

│     └── 128.png

│

├── audio/

│     ├── drum.mp3           # 轉盤音效（姓名抽籤/分類抽籤）

│     └── win.mp3            # 中獎特效（viewer 顯示時播放）

│

├── logo3524.png             # 頁面上方LOGO

│

├── font\_base64.js           # jsPDF 専用 NotoSansTC Base64 字型

└── verseRefMap.js           # 經句書卷章節對照表（001~128）



----------------------------------------------

🚦 抽籤流程介紹

模式一：抽姓名（多人輪流模式）

1\.到 index.html 輸入所有參與者姓名（用逗號分隔）

2\.點選「開始抽姓名」

3\.轉盤指向抽到的人

4\.點選「抽經句」

5\.進入 viewer.html（顯示卡片 + 下載 PNG）

6\.點「下一位」返回 index.html → 下一個人抽



✔ 系統會自動防呆：

\-🟧 姓名輸入後 自動鎖定名單（不可中途修改）

\-⛔ 已抽過的姓名不會再出現

\-⛔ 已抽過的經句不會再抽到

\-🔒 開始此模式後 → 不能使用分類抽籤模式



模式二：分類抽籤（單人模式）

進入 index\_category.html：

1\.選擇分類

2\.轉盤抽分類

3\.點選「抽經句」

4\.進入 viewer.html 顯示圖片

5\.點「回首頁」結束本次抽籤



✔ 系統自動保護：

\-🔒 開始分類模式後 → 不能改用抽姓名

\-⛔ 經句不會與姓名模式重複

\- PDF 會自動記錄「分類 × 經句 × 時間」



--------------------------------------------

🔒 模式鎖定機制（二擇一）



專案中最重要的邏輯：



行為	                                                                                                效果

一旦開始抽姓名模式 → 不能切換去分類模式,	必須按「全部歸零」才能切換

一旦開始分類模式 → 不能切換去抽姓名模式,	必須按「全部歸零」才能切換



避免混用導致經句與姓名紀錄錯亂。



---------------------------------------------

📄 抽籤紀錄 PDF



點選「抽籤紀錄 PDF」會輸出：

\-時間

\-抽到者姓名 or 分類

\-經句編號

\-經文書卷章節（自動加入）

\-多頁自動換頁

\-全字體使用 NotoSansTC（100% 支援繁中）



產生效果示例：



BlessingCards128 抽籤紀錄

\[2025/12/8 上午10:32:45] 惠美｜經句：096（約書亞記 1:8）

\[2025/12/8 上午10:33:19] 德堅｜經句：035（詩篇 27:14）

...



-----------------------------------------------

🖼 PNG 下載功能（viewer.html）

下載的圖片會自動加入兩行文字：



第 1 行（完整紀錄）

\[時間] 姓名｜經句：096（約書亞記 1:8）



第 2 行

抽中的祝福經句紅包



使用 28px NotoSansTC，文字置中、深灰色 #333。



-----------------------------------------------

🧨 視覺效果

\-抽姓名/抽分類時：播放 drum.mp3

\-顯示經句卡片時：播放 win.mp3

-viewer.html 採用 confetti 特效，提升慶祝感



-----------------------------------------------

🔄 全站共用資料（localStorage）



系統會自動儲存：



儲存鍵,	        用途

fixedNameList,	本輪「鎖定後」的姓名清單

usedNamesAll,	已抽過姓名

drawLogs,	所有抽籤紀錄（供 PDF \& PNG 顯示）

nameModeUsed,	是否已啟動抽姓名模式

categoryModeUsed,	是否已啟動分類抽籤模式



✔ 可跨頁同步

✔ 按「全部歸零」後自動清除全部



-------------------------------

🧹 清除（全部歸零）

按下「全部歸零」會：

\-清除全部姓名鎖定

\-清除姓名抽籤進度

\-清除分類模式標記

\-清除全部抽籤紀錄（PDF \& PNG同步清空）

\-清除已抽經句記錄

\-重設所有抽籤狀態



-------------------------------

🛠 開發注意事項

1\. cards 圖片必須命名為三位數：

cards/001.png

cards/002.png

...

cards/128.png



2\. 字型必須使用 font\_base64.js（已最佳化版本）

不可使用其他 Base64 或 PDFMake 字型。



3\. 必須保留：

verseRefMap.js

font\_base64.js

logo3524.png

audio/drum.mp3

audio/win.mp3



------------------------------------------

📝 已知（已修復）問題清單

問題	        狀態

PDF 亂碼,	✔ 已修復（新版 Base64）

PNG 下載無中文,	✔ 已修復（NotoSansTC Canvas 字體）

轉盤指針位置不正確,	✔ 已修正

分類轉盤顏色與 UI,	✔ 已統一

win.mp3 在抽轉盤時誤播放,	✔ 已修復，只在 viewer 播放

不同模式混用導致紀錄錯亂,	✔ 已加入模式鎖定



----------------------------------------

👍 適用場合

\-主日學

\-小組聚會

\-教會活動

\-年終祝福禮

\-團康遊戲

\-抽經句 / 抽祝福卡活動

