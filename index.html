<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç¥ç¦ç¶“å¥ç´…åŒ…ï¼ˆæ‡‰è¨±ç­‰æ‚¨æ‹¿ï¼‰</title>

<style>
body{
  background:#fbf1d6;
  font-family:"Noto Sans TC",system-ui;
  text-align:center;
}

h1{
  color:#9c6b00;
  margin-top:28px;
}

#verseImg{
  width:220px;
  border-radius:8px;
  display:none;
}

input{
  width:80%;
  max-width:520px;
  padding:8px 10px;
  font-size:18px;
  border-radius:12px;
  border:2px solid #d7b36b;
  text-align:center;
}

.btn{
  background:#f3c256;
  border:none;
  padding:9px 16px;
  border-radius:20px;
  margin:6px 6px;
  cursor:pointer;
}

#result{
  margin-top:10px;
  font-size:18px;
}

.flash{
  animation:flash 0.9s infinite;
}
@keyframes flash{
  0%{opacity:1;}
  50%{opacity:.25;}
  100%{opacity:1;}
}
</style>
</head>

<body>

<h1>ç¥ç¦ç¶“å¥ç´…åŒ…ï¼ˆæ‡‰è¨±ç­‰æ‚¨æ‹¿ï¼‰</h1>

<img id="verseImg" src="logo3524.png" alt="verse">

<br>

<input id="nameInput" placeholder="è«‹è¼¸å…¥å§“åï¼ˆé€—è™Ÿæˆ–ç©ºç™½åˆ†éš”ï¼‰">

<br>

<button class="btn" id="lockBtn">é–å®šåå–®</button>
<button class="btn" id="startBtn">é–‹å§‹æŠ½å§“åï¼‹ç¶“å¥</button>
<button class="btn" id="resetBtn">å…¨éƒ¨æ­¸é›¶</button>
<button class="btn" id="pdfBtn">æŠ½ç±¤ç´€éŒ„ PDF</button>

<br>

<canvas id="wheel" width="360" height="360"></canvas>

<div id="result"></div>

<script>
let names=[];
let drawn=new Set();
let spinning=false;
let currentRotation=0;

const SPIN_TIME=7500;
const HIGHLIGHT_TIME=5500;

const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");
const r=canvas.width/2;

/* ---------- å®‰å…¨è¼‰å…¥åœ–ç‰‡ ---------- */
const img=document.getElementById("verseImg");
img.onload=()=>{img.style.display="block"};
img.onerror=()=>{img.style.display="none"};

/* ---------- ç•«è¼ªç›¤ ---------- */
function drawWheel(highlight=-1){

  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(names.length===0)return;

  const n=names.length;
  const arc=2*Math.PI/n;

  for(let i=0;i<n;i++){

    ctx.beginPath();
    ctx.moveTo(r,r);
    ctx.arc(r,r,r-2,i*arc,(i+1)*arc);
    ctx.closePath();

    ctx.fillStyle=(i===highlight)?"#ffcc33":"#f5dca1";
    ctx.fill();

    ctx.strokeStyle="#fff";
    ctx.lineWidth=2;
    ctx.stroke();

    // --------- å§“åç½®ä¸­ï¼ˆä¿®æ­£ç‰ˆæœ¬ï¼‰ ---------
    ctx.save();
    ctx.translate(r,r);
    ctx.rotate(i*arc+arc/2);
    ctx.textAlign="center";
    ctx.font="18px sans-serif";
    ctx.fillStyle="#553300";
    ctx.fillText(names[i],0,-r*0.62);
    ctx.restore();
  }
}

/* ---------- æŠ½ä¸€æ¬¡ ---------- */
function spinOnce(){

  if(spinning||names.length===0)return;
  spinning=true;

  const n=names.length;
  const arc=2*Math.PI/n;

  const winnerIndex=Math.floor(Math.random()*n);
  const winnerName=names[winnerIndex];

  const target=(Math.PI/2)-(winnerIndex*arc+arc/2);
  const fullTurns=4+Math.random()*2;
  const finalRot=fullTurns*2*Math.PI+target;

  const start=performance.now();

  let highlighted=false;

  function animate(now){

    const t=now-start;

    // é«˜äº®èˆ‡ ğŸ¯ åŒæ­¥ï¼š5.5 ç§’
    if(!highlighted && t>=HIGHLIGHT_TIME){
      drawWheel(winnerIndex);
      document.getElementById("result").innerHTML=
        `ğŸ¯ æŠ½ä¸­ã€Œ${winnerName}ã€<br>
         âœ… å·²æŠ½å‡º ${drawn.size+1}/${names.length}`;
      highlighted=true;
    }

    if(t>=SPIN_TIME){
      currentRotation=finalRot%(2*Math.PI);
      drawWheel(winnerIndex);
      drawn.add(winnerName);

      if(drawn.size===names.length){
        document.getElementById("result").innerHTML=
          `ğŸ¯ æŠ½ä¸­ã€Œ${winnerName}ã€<br>
           âœ… å·²æŠ½å‡º ${drawn.size}/${names.length}<br>
           ğŸ‰ æ­¤è¼ªè½‰ç›¤å·²å®Œæˆæ‰€æœ‰å§“åæŠ½ç±¤`;
      }

      spinning=false;
      return;
    }

    const p=t/SPIN_TIME;
    const ease=(--p)*p*p+1;

    const ang=currentRotation+(finalRot-currentRotation)*ease;

    ctx.save();
    ctx.translate(r,r);
    ctx.rotate(ang);
    ctx.translate(-r,-r);
    drawWheel(-1);
    ctx.restore();

    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
}

/* ---------- æŒ‰éˆ• ---------- */

document.getElementById("lockBtn").onclick=()=>{

  let v=document.getElementById("nameInput").value.trim();
  if(!v){ alert("è«‹è¼¸å…¥å§“å"); return; }

  names=v.replace(/,/g," ").split(/\s+/).filter(x=>x);
  drawn.clear();
  currentRotation=0;

  drawWheel();

  document.getElementById("result").innerHTML="åå–®å·²é–å®šï¼Œè«‹é–‹å§‹æ—‹è½‰";
};

document.getElementById("startBtn").onclick=spinOnce;

document.getElementById("resetBtn").onclick=()=>{
  names=[];
  drawn.clear();
  ctx.clearRect(0,0,360,360);
  document.getElementById("result").innerHTML="å·²å…¨éƒ¨æ­¸é›¶";
};

document.getElementById("pdfBtn").onclick=()=>{
  alert("PDF ç›®å‰ç¶­æŒåŸç‰ˆæµç¨‹ï¼Œä¸åœ¨æ­¤ç‰ˆæ”¹å‹•");
};
</script>

</body>
</html>