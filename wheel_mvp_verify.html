<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Wheel MVP Verify</title>
<style>
  body { text-align:center; font-family:sans-serif; }
  canvas { background:#fff8e7; margin-top:20px; }
  button { padding:10px 20px; font-size:16px; }
</style>
</head>
<body>

<h2>æœ€å°å¯é©—è­‰è½‰ç›¤ï¼ˆMVPï¼‰</h2>
<button id="spinBtn">é–‹å§‹æ—‹è½‰</button>

<div style="position:relative; width:400px; margin:auto;">
  <div style="
    position:absolute;
    top:-6px;
    left:50%;
    transform:translateX(-50%);
    font-size:24px;
    color:red;
  ">â–¼</div>
  <canvas id="wheel" width="400" height="400"></canvas>
</div>

<script>
/* ====== åŸºæœ¬è¨­å®š ====== */
const items = ["1","2","3"];   // â† æ”¹é€™è£¡æ¸¬
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const CENTER = 200;
const RADIUS = 180;

let currentRotation = 0;
let isSpinning = false;

/* ====== ç•«è¼ªç›¤ ====== */
function drawWheel(rotation){
  ctx.clearRect(0,0,400,400);
  const count = items.length;
  const arc = Math.PI * 2 / count;

  ctx.save();
  ctx.translate(CENTER, CENTER);
  ctx.rotate(rotation);
  ctx.translate(-CENTER, -CENTER);

  for(let i=0;i<count;i++){
    // â˜… é—œéµï¼šslice ä¸­å¿ƒ = i*arc - PI/2
    const start = i*arc - Math.PI/2 - arc/2;
    const end   = start + arc;

    ctx.beginPath();
    ctx.moveTo(CENTER, CENTER);
    ctx.arc(CENTER, CENTER, RADIUS, start, end);
    ctx.closePath();
    ctx.fillStyle = i%2 ? "#fcdca0" : "#fde7b5";
    ctx.fill();
    ctx.strokeStyle="#fff";
    ctx.lineWidth=2;
    ctx.stroke();

    // æ–‡å­—
    ctx.save();
    ctx.translate(CENTER, CENTER);
    ctx.rotate(i*arc - Math.PI/2);
    ctx.textAlign="right";
    ctx.font="20px sans-serif";
    ctx.fillStyle="#000";
    ctx.fillText(items[i], RADIUS-20, 8);
    ctx.restore();
  }

  ctx.restore();
}

/* ====== easing ====== */
function easeOutCubic(t){
  return 1 - Math.pow(1-t,3);
}

/* ====== æ ¸å¿ƒï¼šè½‰åˆ°æŒ‡å®š index ====== */
function spinToIndex(targetIndex){
  if(isSpinning) return;
  isSpinning = true;

  const count = items.length;
  const arc = Math.PI * 2 / count;

  // slice ä¸­å¿ƒï¼ˆèˆ‡ drawWheel å®Œå…¨ä¸€è‡´ï¼‰
  const targetCenter = targetIndex * arc - Math.PI / 2;
  const pointerAngle = -Math.PI / 2; // 12 é»

  // âœ… è½‰é€Ÿï¼šèˆ‡åŸ index ç›¸åŒ
  const SPEED_BOOST = 1.35;
  const baseSpins = 4.8;
  const spins = baseSpins * SPEED_BOOST;

  // æœ€çµ‚éœ€è¦è½‰çš„ã€Œç›¸å°è§’åº¦ã€
  const deltaRotation =
    (pointerAngle - targetCenter)
    + spins * 2 * Math.PI;

  const startRotation = currentRotation;
  const duration = 4800; // èˆ‡ drum.mp3 é«”æ„Ÿä¸€è‡´
  const t0 = performance.now();

  function frame(now){
    let t = (now - t0) / duration;
    if(t > 1) t = 1;

    const eased = easeOutCubic(t);
    const rot = startRotation + deltaRotation * eased;

    drawWheel(rot);

    if(t < 1){
      requestAnimationFrame(frame);
    }else{
      // âœ… é—œéµï¼šåªåœ¨é€™è£¡å®šæ ¼ä¸€æ¬¡
      currentRotation = startRotation + deltaRotation;
      drawWheel(currentRotation);

      isSpinning = false;
      console.log(
        "ğŸ¯ æŠ½ä¸­ index =", targetIndex,
        "å€¼ =", items[targetIndex]
      );
    }
  }

  requestAnimationFrame(frame);
}


/* ====== æ¸¬è©¦æŒ‰éˆ• ====== */
document.getElementById("spinBtn").onclick = ()=>{
  const idx = Math.floor(Math.random()*items.length);
  spinToIndex(idx);
};

// åˆå§‹
drawWheel(0);
</script>

</body>
</html>
